virtualenv:
  system_site_packages: true

language: python

python:
    - "2.7"

services:
    - docker

before_install:
    - mkdir input
    - mkdir output
    - docker pull neurodata/ndmg_dev:latest
    - docker run -v $(realpath input):/input -v $(realpath output):/output -e "TRAVIS_PULL_REQUEST_BRANCH=$TRAVIS_PULL_REQUEST_BRANCH" -it --entrypoint /bin/bash neurodata/ndmg_dev:latest

install:
    - cd ndmg
    - git fetch --all
    - git checkout $TRAVIS_PULL_REQUEST_BRANCH
    - pip uninstall ndmg
    - pip install -r requirements.txt
    - pip install .

script:
    - ndmg_bids --bucket ndmg-data --remote_path HNU1t --participant_label 0025427 --session_label 1 --modality dwi --atlas desikan --mod det --tt eudx --mf tensor --sp native /input /output participant
    - pytest
