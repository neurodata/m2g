virtualenv:
  system_site_packages: true

language: python

python:
    - "2.7"

services:
    - docker

addons:
  apt:
    packages:
      - docker-ce

before_install:
    # update docker version: https://docs.travis-ci.com/user/docker/
    # - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
    # - sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
    # - sudo apt-get update
    # - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce

    # grab correct branch, update it to the new branch version
    - docker version
    - echo $TRAVIS_BRANCH
    - echo $TRAVIS_PULL_REQUEST_BRANCH
    - mkdir input
    - mkdir output
    - readlink -f input
    - docker pull neurodata/ndmg_dev:latest
    - docker images
    - docker run -t -d --name travis -v $(readlink -f input):/input -v $(readlink -f output):/output --entrypoint /bin/bash neurodata/ndmg_dev:latest
    - docker ps
    - docker exec -w /ndmg travis git fetch --all
    - docker exec -w /ndmg travis git checkout $TRAVIS_BRANCH
    - docker exec -w /ndmg travis git branch

install:
    - docker exec -w /ndmg travis pip uninstall ndmg - y
    - docker exec -w /ndmg travis pip install -r requirements.txt
    - docker exec -w /ndmg travis pip install .

script:
    - docker exec -w /ndmg travis ndmg_bids --bucket ndmg-data --remote_path HNU1t --participant_label 0025427 --session_label 1 --modality dwi --atlas desikan --mod det --tt eudx --mf tensor --sp native /input /output participant
